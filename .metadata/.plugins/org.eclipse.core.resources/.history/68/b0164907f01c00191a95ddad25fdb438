<?xml version="1.0" encoding="UTF-8"?>
<api context="/customers" name="CustomerAPI" xmlns="http://ws.apache.org/ns/synapse">
  <resource methods="POST" protocol="http" uri-template="/customers">
    <inSequence>
      <payloadFactory media-type="json">
        <format>{"purchaseInformation": {"amount": "$1","cc": "$2"}}</format>
        <args>
          <arg evaluator="json" expression="$.payment.amount_lkr"/>
          <arg evaluator="json" expression="$.payment.card_no"/>
        </args>
      </payloadFactory>
      <validate>
        <schema key="conf:/StockQuoteSchema.json"/>
        <on-fail>
          <!-- <payloadFactory media-type="json"> <format>{"Error":$1"}</format> 
						<args> <arg evaluator="xml" expression="$ctx:ERROR_MESSAGE"/> </args> </payloadFactory> 
						<property name="HTTP_SC" scope="axis2" type="STRING" value="500"/> <respond/> -->
          <log description="requestlog">
            <property name="message" value="Received..."/>
          </log>
        </on-fail>
      </validate>
      <log description="requestlog3">
        <property name="message" value="Schema validation failed"/>
      </log>
      <call>
        <endpoint key="customerEI"/>
      </call>
      <log level="full"/>
    </inSequence>
    <outSequence/>
    <faultSequence/>
  </resource>
</api>
