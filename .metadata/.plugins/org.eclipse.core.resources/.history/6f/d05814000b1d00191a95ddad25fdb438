<?xml version="1.0" encoding="UTF-8"?>
<api context="/customers" name="CustomerAPI" xmlns="http://ws.apache.org/ns/synapse">
  <resource methods="POST" protocol="http" uri-template="/customers">
    <inSequence>
      <log level="full"/>
      <payloadFactory description="" media-type="json">
        <format key="conf:/StockQuoteSchema.json"/>
        <args/>
      </payloadFactory>
      <xslt key="conf:/in_transform.xslt"/>
      <property name="messageType" scope="axis2" type="STRING" value="text/xml"/>
      <header name="Action" scope="default" value="urn:getQuote"/>
      <enrich>
        <source clone="true" xmlns:m0="http://services.samples" xpath="//m0:getQuote"/>
        <target type="body"/>
      </enrich>
      <log level="full"/>
      <log description="">
        <property name="message" value="After soap call"/>
      </log>
      <call>
        <endpoint>
          <address format="soap11" trace="disable" uri="http://localhost:8080/_admin"/>
        </endpoint>
      </call>
      <xslt key="conf:/out_transform.xslt"/>
      <property name="messageType" scope="axis2" type="STRING" value="application/json"/>
      <payloadFactory media-type="json">
        <format>{"Status":"OK"}</format>
        <args/>
      </payloadFactory>
      <log>
        <property expression="json-eval($.)" name="JSON-Payload"/>
      </log>
      <property name="messageType" scope="axis2" type="STRING" value="application/json"/>
      <respond/>
      <send/>
    </inSequence>
    <outSequence>
      <log description="">
        <property name="message" value="Inside out seq"/>
      </log>
      <send/>
    </outSequence>
    <faultSequence/>
  </resource>
</api>
